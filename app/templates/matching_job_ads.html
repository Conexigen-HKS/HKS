<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Job Application Matching</title>
  <link rel="stylesheet" href="/static/matching_job_ads.css">
  <script>
    async function handleMatch(action, offerId) {
      const applicationSelect = document.getElementById('applicationSelect');
      const selectedAppId = applicationSelect.value;

      if (!selectedAppId) {
        alert('Please select an active application.');
        return;
      }

      try {
        const response = await fetch('/matches/match_request', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ target_id: offerId, action: action, profile_or_offer_id: selectedAppId }),
        });

        const data = await response.json();
        alert(data.message);
        // Remove the job card from the list
        document.getElementById(`job-${offerId}`).remove();
      } catch (error) {
        alert('An error occurred. Please try again.');
        console.error(error);
      }
    }

    async function handleDislike(offerId) {
      try {
        const response = await fetch('/matches/match_request', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ target_id: offerId, action: 'dislike' }),
        });

        const data = await response.json();
        alert(data.message);
        // Remove the job card from the list
        document.getElementById(`job-${offerId}`).remove();
      } catch (error) {
        alert('An error occurred. Please try again.');
        console.error(error);
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <h1>Match Job Applications</h1>
    
    <label for="applicationSelect">Select an active application:</label>
    <select id="applicationSelect">
      <option value="">--Select Application--</option>
      {% for app in active_applications %}
      <option value="{{ app.id }}">{{ app.title }}</option>
      {% endfor %}
    </select>

    {% for job in jobs %}
    <div class="job-card" id="job-{{ job.id }}">
      <h2>{{ job.description }}</h2>
      <p class="location">{{ job.location }}</p>
      <div class="meta">
        <p><b>Salary:</b> ${{ job.min_salary }} - ${{ job.max_salary }}</p>
        <div class="skills">
          {% for skill in job.skills %}
          <span class="skill">{{ skill }}</span>
          {% endfor %}
        </div>
      </div>
      <div class="actions">
        <button class="action-btn like" onclick="handleMatch('like', '{{ job.id }}')">✔</button>
        <button class="action-btn dislike" onclick="handleDislike('{{ job.id }}')">✖</button>
      </div>
    </div>
    {% endfor %}
  </div>
</body>
</html>